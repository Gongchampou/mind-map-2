(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();const p=document.getElementById("viewport"),g=document.getElementById("wires"),K=document.getElementById("selTxt"),z=document.getElementById("search"),w=document.getElementById("modal"),Z=document.getElementById("modalForm"),Q=document.getElementById("modalTitle"),T=document.getElementById("nodeIdInput"),A=document.getElementById("nodeTitleInput"),q=document.getElementById("nodeUrlInput"),Y=document.getElementById("nodeDescTextarea"),B=document.getElementById("colorPalette"),P=document.getElementById("helpWidget"),ee=document.getElementById("helpToggleBtn"),te=document.getElementById("themeToggleBtn"),k=document.getElementById("lockNodeBtn"),H="brainwave-mindmap-v2",$="brainwave-theme",ne=["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#14b8a6","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#d946ef","#ec4899"],oe=(e,n,s)=>Math.max(n,Math.min(s,e)),O=140,de=60,d={nodes:[],selectedId:null,scale:1,pan:{x:0,y:0},nextId:1,editingNodeId:null,dragState:{isPanning:!1,isDraggingNode:!1,nodeId:null,startX:0,startY:0,startPan:{x:0,y:0},nodeStartPos:{x:0,y:0}}};function m(){const e=JSON.stringify({nodes:d.nodes.map(({width:n,height:s,...t})=>t),nextId:d.nextId,pan:d.pan,scale:d.scale,selectedId:d.selectedId});localStorage.setItem(H,e)}function se(){const e=localStorage.getItem(H);if(!e)return!1;try{const n=JSON.parse(e);return d.nodes=n.nodes||[],d.nodes.forEach(s=>{s.collapsed===void 0&&(s.collapsed=!1),s.locked===void 0&&(s.locked=!1)}),d.nextId=n.nextId||1,d.pan=n.pan||{x:0,y:0},d.scale=n.scale||1,d.selectedId=n.selectedId||null,!0}catch(n){return console.warn("Failed to load from localStorage",n),!1}}function X(){d.nodes.length===0&&d.nodes.push({id:"root",title:"Master The Brain",description:"This is the central idea of your mind map.",url:"",color:9,x:0,y:0,parentId:null,collapsed:!1,locked:!1})}const r=e=>d.nodes.find(n=>n.id===e),y=e=>d.nodes.filter(n=>n.parentId===e),C=e=>(e+"").replace(/[&<>]/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[n]),le=e=>(e+"").replace(/["<>]/g,n=>({'"':"&quot;","<":"&lt;",">":"&gt;"})[n]);function x(){p.style.transform=`translate(${d.pan.x}px, ${d.pan.y}px) scale(${d.scale})`,p.style.transformOrigin="0 0"}function W(){const e=new Set,n=d.nodes.filter(s=>!s.parentId);for(;n.length>0;){const s=n.shift();e.add(s),s.collapsed||y(s.id).forEach(t=>n.push(t))}return Array.from(e)}function I(){const e=W(),n=new Map(Array.from(p.querySelectorAll(".node")).map(t=>[t.dataset.id,t])),s=new Set(e.map(t=>t.id));n.forEach((t,o)=>{s.has(o)||(t.remove(),n.delete(o))}),e.forEach(t=>{let o=n.get(t.id);o||(o=document.createElement("div"),o.dataset.id=t.id,o.tabIndex=0,p.appendChild(o),n.set(t.id,o)),o.className=`node color-${t.color||9}`+(d.selectedId===t.id?" selected":"")+(t.locked?" locked":""),o.style.left=`${t.x}px`,o.style.top=`${t.y}px`;const l=y(t.id).length>0,c=t.collapsed;o.innerHTML=`
          ${t.locked?'<svg class="node-lock-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>':""}
          <div class="title">${C(t.title||"(untitled)")}</div>
          ${t.description?`<div class="description">${C(t.description)}</div>`:""}
          ${t.url?`<a class="url" href="${le(t.url)}" target="_blank" rel="noopener">${C(t.url)}</a>`:""}
          <div class="meta">
            <span class="chip">${y(t.id).length} children</span>
            <span class="chip">ID: ${t.id}</span>
          </div>
          ${l?`<div class="node-collapse-toggle" title="${c?"Expand":"Collapse"}">${c?"+":"âˆ’"}</div>`:""}
        `}),d.nodes.forEach(t=>{const o=n.get(t.id);o&&(t.width=o.offsetWidth,t.height=o.offsetHeight)}),R(e),U(),j()}function R(e){const n=new Set(e.map(i=>i.id));let s=1/0,t=1/0,o=-1/0,l=-1/0;e.length>0?e.forEach(i=>{const u=(i.width||240)/2,f=(i.height||80)/2;s=Math.min(s,i.x-u),t=Math.min(t,i.y-f),o=Math.max(o,i.x+u),l=Math.max(l,i.y+f)}):(s=-500,t=-500,o=500,l=500);const c=200;s-=c,t-=c,o+=c,l+=c,g.style.left=`${s}px`,g.style.top=`${t}px`,g.style.width=`${o-s}px`,g.style.height=`${l-t}px`;const a=g.querySelector("defs");g.innerHTML=a?a.outerHTML:"",e.forEach(i=>{if(i.parentId&&n.has(i.parentId)){const u=r(i.parentId);if(!u)return;const f=u.x+u.width/2,h=u.y,E=i.x-i.width/2,S=i.y,v=document.createElementNS("http://www.w3.org/2000/svg","path"),b=document.createElementNS("http://www.w3.org/2000/svg","path");v.dataset.childId=i.id,b.dataset.childId=i.id;const D=ce(f-s,h-t,E-s,S-t);b.setAttribute("d",D),b.setAttribute("class","wire shadow"),v.setAttribute("d",D),v.setAttribute("class","wire"),g.appendChild(b),g.appendChild(v)}})}function ce(e,n,s,t){const o=e+(s-e)/2;return`M ${e} ${n} C ${o} ${n}, ${o} ${t}, ${s} ${t}`}function N(e){if(d.selectedId!==e){if(d.selectedId){const n=p.querySelector(`.node[data-id="${d.selectedId}"]`);n&&n.classList.remove("selected")}if(d.selectedId=e,e){const n=p.querySelector(`.node[data-id="${e}"]`);n&&n.classList.add("selected")}U(),j(),m()}}function U(){const e=r(d.selectedId);K.textContent=e?`Selected: ${e.title||e.id}`:"No node selected"}function j(){const e=r(d.selectedId),n=!!e,s=d.selectedId==="root",t=n&&e.locked;document.getElementById("editNode").disabled=!n||t,document.getElementById("deleteNode").disabled=!n||s||t,k.disabled=!n,n&&(k.classList.toggle("is-locked",t),k.title=t?"Unlock node (L)":"Lock node (L)")}function ie(e){const n=r(e);n&&(n.collapsed=!n.collapsed,m(),I())}function F(){const e=r(d.selectedId);e&&(e.locked=!e.locked,m(),I())}function _({isNew:e=!1,parentId:n=null}={}){d.editingNodeId=e?null:d.selectedId,Q.textContent=e?"Add Child Node":"Edit Node";let s={title:"",url:"",description:"",color:Math.floor(Math.random()*12)+1};if(!e&&d.editingNodeId){const t=r(d.editingNodeId);t&&(s={...t})}T.value=e?`new-${Date.now()}`:d.editingNodeId,e&&(T.dataset.parentId=n),A.value=s.title,q.value=s.url,Y.value=s.description,B.innerHTML=ne.map((t,o)=>`
    <div class="color-swatch ${s.color===o+1?"selected":""}" 
         style="background-color: ${t};" 
         data-color-index="${o+1}">
    </div>
  `).join(""),w.style.display="flex",A.focus()}function M(){w.style.display="none",d.editingNodeId=null}Z.addEventListener("submit",e=>{e.preventDefault();const n=A.value.trim();if(!n)return;const s=q.value.trim(),t=Y.value.trim(),o=B.querySelector(".selected"),l=o?parseInt(o.dataset.colorIndex):1;if(d.editingNodeId){const c=r(d.editingNodeId);c&&Object.assign(c,{title:n,url:s,description:t,color:l})}else{const c=T.dataset.parentId;let a=r(c);a||(a=r("root"),a||(X(),a=r("root")));const i=String(d.nextId++),u=y(a.id);let f;u.length===0?f=a.y||0:f=u.reduce((E,S)=>{const v=S.height??O;return Math.max(E,S.y+v/2)},-1/0)+de+O/2,d.nodes.push({id:i,title:n,url:s,description:t,color:l,x:(a.x||0)+350,y:f,parentId:a.id,collapsed:!1,locked:!1}),N(i)}M(),m(),I()});const J=()=>_({isNew:!0,parentId:d.selectedId||"root"}),V=()=>{d.selectedId&&_()};function G(){const e=d.selectedId,n=r(e);if(!n||n.id==="root"||n.locked){alert("Cannot delete the root node or a locked node.");return}if(!confirm("Delete selected node and all its descendants?"))return;const s=new Set;(function t(o){s.add(o),y(o).forEach(l=>t(l.id))})(e),d.nodes=d.nodes.filter(t=>!s.has(t.id)),N(null),m(),I()}function ae(){const e=r("root");if(!e)return;const n=350,s=30;function t(l){const c=r(l),a=y(l);return c.collapsed||a.length===0?(c.height||100)+s:a.reduce((i,u)=>i+t(u.id),0)}function o(l,c,a){if(l.locked||(l.x=c,l.y=a,l.collapsed))return;const i=y(l.id),u=t(l.id)-((l.height||100)+s);let f=a-u/2;i.forEach(h=>{const E=t(h.id);o(h,c+n,f+E/2),f+=E})}o(e,e.x,e.y),m(),I(),L()}function L(){const e=document.body.getBoundingClientRect(),n=r("root");n&&(d.pan.x=e.width/2-n.x*d.scale,d.pan.y=e.height/2-n.y*d.scale,x(),m())}function re(){d.scale=1,d.pan={x:0,y:0},x(),m(),I(),L()}function ue(){const n={nodes:d.nodes.map(({width:o,height:l,...c})=>c),nextId:d.nextId},s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),t=document.createElement("a");t.href=URL.createObjectURL(s),t.download="brainwave-mindmap.json",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href)}function fe(e){const n=e.target;if(w.style.display!=="none")return;if(n.classList.contains("node-collapse-toggle")){ie(n.closest(".node").dataset.id);return}const s=n.closest(".node");if(s){const t=r(s.dataset.id);if(N(t.id),t.locked||e.button!==0)return;s.style.cursor="grabbing",d.dragState={isDraggingNode:!0,isPanning:!1,nodeId:t.id,startX:e.clientX,startY:e.clientY,nodeStartPos:{x:t.x,y:t.y}},s.setPointerCapture(e.pointerId)}else n.closest("#viewport")&&(d.dragState={isPanning:!0,isDraggingNode:!1,startX:e.clientX,startY:e.clientY,startPan:{...d.pan}},document.body.classList.add("is-panning"),p.setPointerCapture(e.pointerId))}function ge(e){const{isPanning:n,isDraggingNode:s,startX:t,startY:o,startPan:l,nodeStartPos:c,nodeId:a}=d.dragState;if(n)d.pan.x=l.x+(e.clientX-t),d.pan.y=l.y+(e.clientY-o),x();else if(s){const i=r(a);if(!i)return;const u=(e.clientX-t)/d.scale,f=(e.clientY-o)/d.scale;i.x=c.x+u,i.y=c.y+f;const h=p.querySelector(`.node[data-id="${i.id}"]`);h&&requestAnimationFrame(()=>{h.style.left=`${i.x}px`,h.style.top=`${i.y}px`,R(W())})}}function pe(e){if(d.dragState.isPanning)document.body.classList.remove("is-panning"),m();else if(d.dragState.isDraggingNode){const n=p.querySelector(`.node[data-id="${d.dragState.nodeId}"]`);n&&(n.style.cursor="grab"),m()}d.dragState={isPanning:!1,isDraggingNode:!1,nodeId:null}}window.addEventListener("pointerdown",fe);window.addEventListener("pointermove",ge);window.addEventListener("pointerup",pe);window.addEventListener("wheel",e=>{if(!e.target.closest("#stage")||w.style.display!=="none")return;e.preventDefault();const n=-e.deltaY,s=Math.exp(n*.001),t=d.scale,o=oe(t*s,.2,3);if(o===t)return;const l=p.getBoundingClientRect(),c=e.clientX-l.left,a=e.clientY-l.top;d.pan.x=c-(c-d.pan.x)*(o/t),d.pan.y=a-(a-d.pan.y)*(o/t),d.scale=o,x(),m()},{passive:!1});function me(){localStorage.getItem($)==="light"&&(document.documentElement.dataset.theme="light"),te.addEventListener("click",()=>{document.documentElement.hasAttribute("data-theme")?(document.documentElement.removeAttribute("data-theme"),localStorage.removeItem($)):(document.documentElement.dataset.theme="light",localStorage.setItem($,"light"))})}function he(){localStorage.getItem("brainwave-help-collapsed")==="true"&&P.classList.add("collapsed"),ee.addEventListener("click",()=>{const n=P.classList.toggle("collapsed");localStorage.setItem("brainwave-help-collapsed",n)})}document.getElementById("addChild").onclick=J;document.getElementById("editNode").onclick=V;document.getElementById("deleteNode").onclick=G;k.onclick=F;document.getElementById("layoutBtn").onclick=ae;document.getElementById("centerBtn").onclick=L;document.getElementById("resetBtn").onclick=re;document.getElementById("exportBtn").onclick=ue;document.getElementById("file").addEventListener("change",e=>{const n=e.target.files[0];if(!n)return;const s=new FileReader;s.onload=()=>{try{const t=JSON.parse(s.result);if(!t||!Array.isArray(t.nodes))throw new Error("Invalid format");d.nodes=t.nodes,d.nodes.forEach(o=>{o.collapsed===void 0&&(o.collapsed=!1),o.locked===void 0&&(o.locked=!1)}),d.nextId=t.nextId||Math.max(...d.nodes.map(o=>typeof o.id=="number"?o.id:0),0)+1,N(null),m(),I(),L()}catch(t){alert("Invalid or corrupted JSON file."),console.error("Import failed:",t)}},s.readAsText(n),e.target.value=""});B.addEventListener("click",e=>{var n;e.target.classList.contains("color-swatch")&&((n=B.querySelector(".selected"))==null||n.classList.remove("selected"),e.target.classList.add("selected"))});document.getElementById("cancelBtn").addEventListener("click",M);w.addEventListener("click",e=>{e.target===w&&M()});z.addEventListener("input",e=>{const n=e.target.value.toLowerCase();document.querySelectorAll(".node").forEach(s=>{const t=r(s.dataset.id);if(t){const o=n&&t.title.toLowerCase().includes(n);s.classList.toggle("highlight",o)}})});p.addEventListener("mouseover",e=>{const n=e.target.closest(".node");if(n){const s=n.dataset.id;g.querySelectorAll(`[data-child-id="${s}"]`).forEach(l=>l.classList.add("active")),y(s).forEach(l=>{g.querySelectorAll(`[data-child-id="${l.id}"]`).forEach(a=>a.classList.add("active"))})}});p.addEventListener("mouseout",e=>{const n=e.target.closest(".node");if(n){const s=n.dataset.id;g.querySelectorAll(`[data-child-id="${s}"]`).forEach(l=>l.classList.remove("active")),y(s).forEach(l=>{g.querySelectorAll(`[data-child-id="${l.id}"]`).forEach(a=>a.classList.remove("active"))})}});window.addEventListener("keydown",e=>{document.activeElement.tagName==="INPUT"||document.activeElement.tagName==="TEXTAREA"||((e.key==="Delete"||e.key==="Backspace")&&(e.preventDefault(),G()),(e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="e"&&(e.preventDefault(),V()),(e.key.toLowerCase()==="a"||e.key==="+")&&(e.preventDefault(),J()),e.key.toLowerCase()==="l"&&(e.preventDefault(),F()))});function ye(){se()||X(),me(),x(),I(),L(),he()}document.addEventListener("DOMContentLoaded",ye);window.addEventListener("resize",I);
